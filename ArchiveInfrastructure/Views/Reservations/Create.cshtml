@model ArchiveInfrastructure.ViewModels.ReservationCreateViewModel

@{
    ViewData["Title"] = "Бронювання документа";
}

<h2 class="mb-4 text-center">Бронювання документа</h2>

<div class="alert alert-info">
    Виберіть дату та час початку і завершення бронювання. <br />
    <strong>Увага:</strong> доступно лише у робочі дні (пн–пт), з 09:00 до 17:00. Максимальна тривалість — 2 години.
</div>

<form asp-action="Create" method="post" class="bg-white p-4 rounded shadow">
    <input type="hidden" asp-for="DocumentInstanceId" />

    <div class="mb-3">
        <label asp-for="StartDateTime" class="form-label">Початок бронювання</label>
        <input asp-for="StartDateTime" type="text" class="form-control" id="StartDateTime" />
        <span asp-validation-for="StartDateTime" class="text-danger"></span>
    </div>

    <div class="mb-3">
        <label asp-for="EndDateTime" class="form-label">Завершення бронювання</label>
        <input asp-for="EndDateTime" type="text" class="form-control" id="EndDateTime" />
        <span asp-validation-for="EndDateTime" class="text-danger"></span>
    </div>

    <div class="d-flex gap-3">
        <button type="submit" class="btn btn-primary btn-animated">Підтвердити</button>
        <a asp-controller="Documents" asp-action="Index" class="btn btn-secondary btn-animated">← Назад до документів</a>
    </div>
</form>

@section Scripts {
    @await Html.PartialAsync("_ValidationScriptsPartial")

    <!-- Стилі та скрипти для Flatpickr -->
    <link href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/uk.js"></script> <!-- українською -->

    <script>
        const baseConfig = {
            enableTime: true,
            dateFormat: "Y-m-d H:i",
            minDate: "today", // Заборона на минулі дні
            time_24hr: true,
            locale: "uk",
            disable: [
                function (date) {
                    return (date.getDay() === 0 || date.getDay() === 6); // Неділя або субота
                }
            ]
        };

        // Початок бронювання
        flatpickr("#StartDateTime", {
            ...baseConfig,
            minTime: "09:00",
            maxTime: "15:00",
            onChange: function (selectedDates) {
                if (selectedDates.length > 0) {
                    const start = selectedDates[0];
                    const end = new Date(start.getTime() + 2 * 60 * 60 * 1000); // +2 години
                    end.setSeconds(0);
                    end.setMilliseconds(0);
                    document.querySelector("#EndDateTime")._flatpickr.setDate(end);
                }
            }
        });

        // Завершення бронювання
        flatpickr("#EndDateTime", {
            ...baseConfig,
            minTime: "09:00",
            maxTime: "17:00"
        });
    </script>
}
